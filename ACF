LIBRARY IEEE;
USE IEEE.STD_LOGIC_1164.ALL;

ENTITY can_vhdl_acf IS
   PORT (
      clk                      : IN std_logic;     
      rst         	       : IN std_logic;
      id_std                   : IN std_logic_vector(10 DOWNTO 0);     
      acceptance_filter_std    : IN std_logic_vector(10 DOWNTO 0);   
      acceptance_mask_std      : IN std_logic_vector(10 DOWNTO 0);
      id_ext		       : IN std_logic_vector(28 DOWNTO 0);
      acceptance_filter_ext    : IN std_logic_vector(28 DOWNTO 0);
      acceptance_mask_ext      : IN std_logic_vector(28 DOWNTO 0); 
      ide		       : IN std_logic;    
      id_ok                    : OUT std_logic);   
END ENTITY can_vhdl_acf;

ARCHITECTURE RTL OF can_vhdl_acf IS

BEGIN 

id_check: PROCESS (clk)
  VARIABLE temp	:  std_logic;
  BEGIN
    IF RISING_EDGE(clk) THEN
       IF rst='1' THEN id_ok<='0';
       ELSE
         temp  :=  '1' ;
          IF(ide='0') THEN
             FOR i in 10 DOWNTO 0 LOOP
                  temp := ( ( id_std(i) XNOR acceptance_filter_std(i)) OR ( NOT(acceptance_mask_std(i)) ) );
                  IF (temp='0') THEN id_ok <='0';EXIT;
                  ELSE id_ok <='1';
                  END IF;
             END LOOP;
          ELSE
             FOR i in 28 DOWNTO 0 LOOP
  	          temp := ( ( id_ext(i) XNOR acceptance_filter_ext(i)) OR ( NOT(acceptance_mask_ext(i)) ) );
	          IF (temp='0') THEN id_ok <='0';EXIT;
	          ELSE id_ok <='1';
	          END IF;
             END LOOP;
          END IF;
       END IF;
    END IF;  
  END PROCESS id_check;

END ARCHITECTURE RTL;
